(function(a){function d(){this.controls={bold:{groupIndex:0,visible:!0,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:!1,tooltip:"Copy"},createLink:{groupIndex:6,visible:!0,exec:function(){var c=this;a.wysiwyg.controls&&a.wysiwyg.controls.link?a.wysiwyg.controls.link.init(this):a.wysiwyg.autoload?a.wysiwyg.autoload.control("wysiwyg.link.js",function(){c.controls.createLink.exec.apply(c)}):b.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")},tags:["a"],tooltip:"Create link"},cut:{groupIndex:8,visible:!1,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:!1,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:!0,className:"h1",command:a.browser.msie||a.browser.safari?"FormatBlock":"heading",arguments:a.browser.msie||a.browser.safari?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:!0,className:"h2",command:a.browser.msie||a.browser.safari?"FormatBlock":"heading",arguments:a.browser.msie||a.browser.safari?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:!0,className:"h3",command:a.browser.msie||a.browser.safari?"FormatBlock":"heading",arguments:a.browser.msie||a.browser.safari?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:!1,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var b,c,d,e;a.browser.msie||a.browser.safari?b="backcolor":b="hilitecolor";if(a.browser.msie)c=this.getInternalRange().parentElement();else{d=this.getInternalSelection(),c=d.extentNode||d.focusNode;while(c.style===undefined){c=c.parentNode;if(c.tagName&&c.tagName.toLowerCase()==="body")return}}c.style.backgroundColor==="rgb(255, 255, 102)"||c.style.backgroundColor==="#ffff66"?e="#ffffff":e="#ffff66",this.editorDoc.execCommand(b,!1,e)}},html:{groupIndex:10,visible:!1,exec:function(){var b;this.options.resizeOptions&&a.fn.resizable&&(b=this.element.height()),this.viewHTML?(this.setContent(this.original.value),a(this.original).hide(),this.editor.show(),this.options.resizeOptions&&a.fn.resizable&&(b===this.element.height()&&this.element.height(b+this.editor.height()),this.element.resizable(a.extend(!0,{alsoResize:this.editor},this.options.resizeOptions))),this.ui.toolbar.find("li").each(function(){var b=a(this);b.hasClass("html")?b.removeClass("active"):b.removeClass("disabled")})):(this.saveContent(),a(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show(),this.editor.hide(),this.options.resizeOptions&&a.fn.resizable&&(b===this.element.height()&&this.element.height(this.ui.toolbar.height()),this.element.resizable("destroy")),this.ui.toolbar.find("li").each(function(){var b=a(this);b.hasClass("html")?b.addClass("active"):!1===b.hasClass("fullscreen")&&b.removeClass("active").addClass("disabled")})),this.viewHTML=!this.viewHTML},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:!1,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:!0,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:!0,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:!0,exec:function(){var c=this;a.wysiwyg.controls&&a.wysiwyg.controls.image?a.wysiwyg.controls.image.init(this):a.wysiwyg.autoload?a.wysiwyg.autoload.control("wysiwyg.image.js",function(){c.controls.insertImage.exec.apply(c)}):b.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:!0,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:!0,exec:function(){var c=this;a.wysiwyg.controls&&a.wysiwyg.controls.table?a.wysiwyg.controls.table(this):a.wysiwyg.autoload?a.wysiwyg.autoload.control("wysiwyg.table.js",function(){c.controls.insertTable.exec.apply(c)}):b.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:!0,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:!0,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:!0,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:!0,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:!0,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:!0,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:!1,exec:function(){var b=this.dom.getElement("p");return b?(a(b).attr("dir","ltr"),!0):!1},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:!0,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:!1,className:"paragraph",command:"FormatBlock",arguments:a.browser.msie||a.browser.safari?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:!1,tooltip:"Paste"},redo:{groupIndex:4,visible:!0,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:!0,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:!1,exec:function(){var b=this.dom.getElement("p");return b?(a(b).attr("dir","rtl"),!0):!1},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:!0,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:!0,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:!0,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:!0,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:!0,tooltip:"Undo"},code:{visible:!0,groupIndex:6,tooltip:"Code snippet",exec:function(){var b=this.getInternalRange(),c=a(b.commonAncestorContainer),d=b.commonAncestorContainer.nodeName.toLowerCase();c.parent("code").length?c.unwrap():d!=="body"&&c.wrap("<code/>")}},cssWrap:{visible:!1,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){a.wysiwyg.controls.cssWrap.init(this)}}},this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:!1,controls:{},css:{},events:{},autoGrow:!1,autoSave:!0,brIE:!0,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"<p>Initial content</p>",maxHeight:1e4,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:!1,replaceDivWithP:!1,resizeOptions:!1,rmUnusedControls:!1,rmUnwantedBr:!0,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:!1},controlLink:{forceRelativeUrls:!1},plugins:{autoload:!1,i18n:!1,rmFormat:{rmMsWordMarkup:!1}},dialog:"default"},this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"],this.editor=null,this.editorDoc=null,this.element=null,this.options={},this.original=null,this.savedRange=null,this.timers=[],this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46],this.isDestroyed=!1,this.dom={ie:{parent:null},w3c:{parent:null}},this.dom.parent=this,this.dom.ie.parent=this.dom,this.dom.w3c.parent=this.dom,this.ui={},this.ui.self=this,this.ui.toolbar=null,this.ui.initialHeight=null,this.dom.getAncestor=function(a,b){b=b.toLowerCase();while(a&&typeof a.tagName!="undefined"&&"body"!==a.tagName.toLowerCase()){if(b===a.tagName.toLowerCase())return a;a=a.parentNode}if(!a.tagName&&(a.previousSibling||a.nextSibling)){if(a.previousSibling&&a.previousSibling.tagName.toLowerCase()==b)return a.previousSibling;if(a.nextSibling&&a.nextSibling.tagName.toLowerCase()==b)return a.nextSibling}return null},this.dom.getElement=function(a){var b=this;return a=a.toLowerCase(),window.getSelection?b.w3c.getElement(a):b.ie.getElement(a)},this.dom.ie.getElement=function(a){var b=this.parent,c=b.parent.getInternalSelection(),d=c.createRange(),e;if("Control"===c.type)if(1===d.length)e=d.item(0);else return null;else e=d.parentElement();return b.getAncestor(e,a)},this.dom.w3c.getElement=function(a){var b=this.parent,c=b.parent.getInternalRange(),d;if(!c)return null;d=c.commonAncestorContainer,3===d.nodeType&&(d=d.parentNode),d===c.startContainer&&(d=d.childNodes[c.startOffset]);if(!d.tagName&&(d.previousSibiling||d.nextSibling)){if(d.previousSibiling&&d.previousSibiling.tagName.toLowerCase()==a)return d.previousSibiling;if(d.nextSibling&&d.nextSibling.tagName.toLowerCase()==a)return d.nextSibling}return b.getAncestor(d,a)},this.ui.addHoverClass=function(){a(this).addClass("wysiwyg-button-hover")},this.ui.appendControls=function(){var b=this,c=this.self,d=c.parseControls(),e=!0,f=[],g={},h,i,j=function(a,c){c.groupIndex&&i!==c.groupIndex&&(i=c.groupIndex,e=!1);if(!c.visible)return;e||(b.appendItemSeparator(),e=!0),c.custom?b.appendItemCustom(a,c):b.appendItem(a,c)};a.each(d,function(a,b){var c="empty";undefined!==b.groupIndex&&(""===b.groupIndex?c="empty":c=b.groupIndex),undefined===g[c]&&(f.push(c),g[c]={}),g[c][a]=b}),f.sort(function(a,b){return"number"==typeof a&&typeof a==typeof b?a-b:(a=a.toString(),b=b.toString(),a>b?1:a===b?0:-1)}),0<f.length&&(i=f[0]);for(h=0;h<f.length;h+=1)a.each(g[f[h]],j)},this.ui.appendItem=function(b,c){var d=this.self,e=c.className||c.command||b||"empty",f=c.tooltip||c.command||b||"";return a('<li role="menuitem" unselectable="on">'+e+"</li>").addClass(e).attr("title",f).hover(this.addHoverClass,this.removeHoverClass).click(function(e){if(a(this).hasClass("disabled"))return!1;d.triggerControl.apply(d,[b,c]);var f=a(e.target);for(var g in d.controls)if(f.hasClass(g)){d.ui.toolbar.find("."+g).toggleClass("active"),d.editorDoc.rememberCommand=!0;break}return this.blur(),d.ui.returnRange(),d.ui.focus(),!0}).appendTo(d.ui.toolbar)},this.ui.appendItemCustom=function(b,c){var d=this.self,e=c.tooltip||c.command||b||"";return c.callback&&a(window).bind("trigger-"+b+".wysiwyg",c.callback),a('<li role="menuitem" unselectable="on" style="background: url(\''+c.icon+"') no-repeat;\"></li>").addClass("custom-command-"+b).addClass("wysiwyg-custom-command").addClass(b).attr("title",e).hover(this.addHoverClass,this.removeHoverClass).click(function(){return a(this).hasClass("disabled")?!1:(d.triggerControl.apply(d,[b,c]),this.blur(),d.ui.returnRange(),d.ui.focus(),d.triggerControlCallback(b),!0)}).appendTo(d.ui.toolbar)},this.ui.appendItemSeparator=function(){var b=this.self;return a('<li role="separator" class="separator"></li>').appendTo(b.ui.toolbar)},this.autoSaveFunction=function(){this.saveContent()},this.ui.checkTargets=function(b){var c=this.self;a.each(c.options.controls,function(d,e){var f=e.className||e.command||d||"empty",g,h,i,j,k=function(a,b){var d;"function"==typeof b?(d=b,d(j.css(a).toString().toLowerCase(),c)&&c.ui.toolbar.find("."+f).addClass("active")):j.css(a).toString().toLowerCase()===b&&c.ui.toolbar.find("."+f).addClass("active")};"fullscreen"!==f&&c.ui.toolbar.find("."+f).removeClass("active");if(e.tags||e.options&&e.options.tags){g=e.tags||e.options&&e.options.tags,h=b;while(h){if(h.nodeType!==1)break;a.inArray(h.tagName.toLowerCase(),g)!==-1&&c.ui.toolbar.find("."+f).addClass("active"),h=h.parentNode}}if(e.css||e.options&&e.options.css){i=e.css||e.options&&e.options.css,j=a(b);while(j){if(j[0].nodeType!==1)break;a.each(i,k),j=j.parent()}}})},this.ui.designMode=function(){var a=3,b=this.self,c;c=function(a){if("on"===b.editorDoc.designMode){b.timers.designMode&&window.clearTimeout(b.timers.designMode),b.innerDocument()!==b.editorDoc&&b.ui.initFrame();return}try{b.editorDoc.designMode="on"}catch(d){}a-=1,a>0&&(b.timers.designMode=window.setTimeout(function(){c(a)},100))},c(a)},this.destroy=function(){this.isDestroyed=!0;var b,c=this.element.closest("form");for(b=0;b<this.timers.length;b+=1)window.clearTimeout(this.timers[b]);return c.unbind(".wysiwyg"),this.element.remove(),a.removeData(this.original,"wysiwyg"),a(this.original).show(),this},this.getRangeText=function(){var a=this.getInternalRange();return a.toString?a=a.toString():a.text&&(a=a.text),a},this.execute=function(a,b){typeof b=="undefined"&&(b=null),this.editorDoc.execCommand(a,!1,b)},this.extendOptions=function(b){var c={};return"object"==typeof b.controls&&(c=b.controls,delete b.controls),b=a.extend(!0,{},this.defaults,b),b.controls=a.extend(!0,{},c,this.controls,c),b.rmUnusedControls&&a.each(b.controls,function(a){c[a]||delete b.controls[a]}),b},this.ui.focus=function(){var a=this.self;return a.editor.get(0).contentWindow.focus(),a},this.ui.returnRange=function(){var a=this.self,c;if(a.savedRange!==null){if(window.getSelection){c=window.getSelection(),c.rangeCount>0&&c.removeAllRanges();try{c.addRange(a.savedRange)}catch(d){b.error(d)}}else window.document.createRange?window.getSelection().addRange(a.savedRange):window.document.selection&&a.savedRange.select();a.savedRange=null}},this.increaseFontSize=function(){if(a.browser.mozilla||a.browser.opera)this.editorDoc.execCommand("increaseFontSize",!1,null);else if(a.browser.safari){var c=this.getInternalRange(),d=this.getInternalSelection(),e=this.editorDoc.createElement("big");if(!0===c.collapsed&&3===c.commonAncestorContainer.nodeType){var f=c.commonAncestorContainer.nodeValue.toString(),g=f.lastIndexOf(" ",c.startOffset)+1,h=-1===f.indexOf(" ",c.startOffset)?f:f.indexOf(" ",c.startOffset);c.setStart(c.commonAncestorContainer,g),c.setEnd(c.commonAncestorContainer,h),c.surroundContents(e),d.addRange(c)}else c.surroundContents(e),d.removeAllRanges(),d.addRange(c)}else b.error("Internet Explorer?")},this.decreaseFontSize=function(){if(a.browser.mozilla||a.browser.opera)this.editorDoc.execCommand("decreaseFontSize",!1,null);else if(a.browser.safari){var c=this.getInternalRange(),d=this.getInternalSelection(),e=this.editorDoc.createElement("small");if(!0===c.collapsed&&3===c.commonAncestorContainer.nodeType){var f=c.commonAncestorContainer.nodeValue.toString(),g=f.lastIndexOf(" ",c.startOffset)+1,h=-1===f.indexOf(" ",c.startOffset)?f:f.indexOf(" ",c.startOffset);c.setStart(c.commonAncestorContainer,g),c.setEnd(c.commonAncestorContainer,h),c.surroundContents(e),d.addRange(c)}else c.surroundContents(e),d.removeAllRanges(),d.addRange(c)}else b.error("Internet Explorer?")},this.getContent=function(){return this.viewHTML&&this.setContent(this.original.value),this.events.filter("getContent",this.editorDoc.body.innerHTML)},this.events={_events:{},bind:function(a,b){typeof this._events.eventName!="object"&&(this._events[a]=[]),this._events[a].push(b)},trigger:function(b,c){if(typeof this._events.eventName=="object"){var d=this.editor;a.each(this._events[b],function(a,b){typeof b=="function"&&b.apply(d,c)})}},filter:function(b,c){if(typeof this._events[b]=="object"){var d=this.editor,e=Array.prototype.slice.call(arguments,1);a.each(this._events[b],function(a,b){typeof b=="function"&&(c=b.apply(d,e))})}return c}},this.getElementByAttributeValue=function(b,c,d){var e,f,g=this.editorDoc.getElementsByTagName(b);for(e=0;e<g.length;e+=1){f=g[e].getAttribute(c),a.browser.msie&&(f=f.substr(f.length-d.length));if(f===d)return g[e]}return!1},this.getInternalRange=function(){var a=this.getInternalSelection();return a?a.rangeCount&&a.rangeCount>0?a.getRangeAt(0):a.createRange?a.createRange():null:null},this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection)return this.editor.get(0).contentWindow.getSelection();if(this.editor.get(0).contentWindow.selection)return this.editor.get(0).contentWindow.selection}return this.editorDoc.getSelection?this.editorDoc.getSelection():this.editorDoc.selection?this.editorDoc.selection:null},this.getRange=function(){var a=this.getSelection();if(!a)return null;if(a.rangeCount&&a.rangeCount>0)a.getRangeAt(0);else if(a.createRange)return a.createRange();return null},this.getSelection=function(){return window.getSelection?window.getSelection():window.document.selection},this.ui.grow=function(){var b=this.self,c=a(b.editorDoc.body),d=a.browser.msie?c[0].scrollHeight:c.height()+2+20,e=b.ui.initialHeight,f=Math.max(d,e);return f=Math.min(f,b.options.maxHeight),b.editor.attr("scrolling",f<b.options.maxHeight?"no":"auto"),c.css("overflow",f<b.options.maxHeight?"hidden":""),b.editor.get(0).height=f,b},this.init=function(b,c){var d=this,e=a(b).closest("form"),f=b.width||b.clientWidth||0,g=b.height||b.clientHeight||0;this.options=this.extendOptions(c),this.original=b,this.ui.toolbar=a(this.options.toolbarHtml),a.browser.msie&&parseInt(a.browser.version,10)<8&&(this.options.autoGrow=!1),f===0&&b.cols&&(f=b.cols*8+21),g===0&&b.rows&&(g=b.rows*16+16),this.editor=a(window.location.protocol==="https:"?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0"),this.options.iFrameClass?this.editor.addClass(this.options.iFrameClass):(this.editor.css({minHeight:(g-6).toString()+"px",width:f>50?(f-8).toString()+"px":""}),a.browser.msie&&parseInt(a.browser.version,10)<7&&this.editor.css("height",g.toString()+"px"));if(b.id){var h=b.id+"-wysiwyg-iframe";document.getElementById(h)||this.editor.attr("id",h)}this.editor.attr("tabindex",a(b).attr("tabindex")),this.element=a("<div/>").addClass("wysiwyg"),this.options.iFrameClass||this.element.css({width:f>0?f.toString()+"px":"100%"}),a(b).hide().before(this.element),this.viewHTML=!1,this.initialContent=a(b).val(),this.ui.initFrame(),this.options.resizeOptions&&a.fn.resizable&&this.element.resizable(a.extend(!0,{alsoResize:this.editor},this.options.resizeOptions)),this.options.autoSave&&e.bind("submit.wysiwyg",function(){d.autoSaveFunction()}),e.bind("reset.wysiwyg",function(){d.resetFunction()})},this.ui.initFrame=function(){var c=this.self,d,e,f;c.ui.appendControls(),c.element.append(c.ui.toolbar).append(a("<div><!-- --></div>").css({clear:"both"})).append(c.editor),c.editorDoc=c.innerDocument();if(c.isDestroyed)return null;c.ui.designMode(),c.editorDoc.open(),c.editorDoc.write(c.options.html.replace(/INITIAL_CONTENT/,function(){return c.wrapInitialContent()})),c.editorDoc.close(),a.wysiwyg.plugin.bind(c),a(c.editorDoc).trigger("initFrame.wysiwyg"),a(c.editorDoc).bind("click.wysiwyg",function(a){c.ui.checkTargets(a.target?a.target:a.srcElement)}),setInterval(function(){var d=null;try{var e=c.getInternalRange();e&&(d={range:e,parent:a.browser.msie?e.parentElement():e.endContainer.parentNode,width:(a.browser.msie?e.boundingWidth:e.startOffset-e.endOffset)||0})}catch(f){b.error(f)}d&&d.width==0&&!c.editorDoc.rememberCommand&&c.ui.checkTargets(d.parent)},400),a(c.original).focus(function(){if(a(this).filter(":visible").length===0)return;c.ui.focus()}),a(c.editorDoc).keydown(function(a){var b;if(a.keyCode===8){b=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/;if(b.test(c.getContent()))return a.stopPropagation(),!1}return c.editorDoc.rememberCommand=!1,!0}),a.browser.msie?c.options.brIE&&a(c.editorDoc).keydown(function(a){if(a.keyCode===13){var b=c.getRange();return b.pasteHTML("<br/>"),b.collapse(!1),b.select(),!1}return!0}):a(c.editorDoc).keydown(function(a){var b;if(a.ctrlKey||a.metaKey)for(b in c.controls)if(c.controls[b].hotkey&&c.controls[b].hotkey.ctrl&&a.keyCode===c.controls[b].hotkey.key)return c.triggerControl.apply(c,[b,c.controls[b]]),!1;return!0}),c.options.plugins.rmFormat.rmMsWordMarkup&&a(c.editorDoc).bind("keyup.wysiwyg",function(b){(b.ctrlKey||b.metaKey)&&86===b.keyCode&&a.wysiwyg.rmFormat&&("object"==typeof c.options.plugins.rmFormat.rmMsWordMarkup?a.wysiwyg.rmFormat.run(c,{rules:{msWordMarkup:c.options.plugins.rmFormat.rmMsWordMarkup}}):a.wysiwyg.rmFormat.run(c,{rules:{msWordMarkup:{enabled:!0}}}))}),c.options.autoSave&&a(c.editorDoc).keydown(function(){c.autoSaveFunction()}).keyup(function(){c.autoSaveFunction()}).mousedown(function(){c.autoSaveFunction()}).bind(a.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){c.autoSaveFunction()}),c.options.autoGrow&&(c.options.initialMinHeight!==null?c.ui.initialHeight=c.options.initialMinHeight:c.ui.initialHeight=a(c.editorDoc).height(),a(c.editorDoc.body).css("border","1px solid white"),e=function(){c.ui.grow()},a(c.editorDoc).keyup(e),a(c.editorDoc).bind("editorRefresh.wysiwyg",e),c.ui.grow()),c.options.css&&(String===c.options.css.constructor?a.browser.msie?(d=c.editorDoc.createStyleSheet(c.options.css),a(d).attr({media:"all"})):(d=a("<link/>").attr({href:c.options.css,media:"all",rel:"stylesheet",type:"text/css"}),a(c.editorDoc).find("head").append(d)):c.timers.initFrame_Css=window.setTimeout(function(){a(c.editorDoc.body).css(c.options.css)},0)),c.initialContent.length===0&&("function"==typeof c.options.initialContent?c.setContent(c.options.initialContent()):c.setContent(c.options.initialContent)),c.options.maxLength>0&&a(c.editorDoc).keydown(function(b){a(c.editorDoc).text().length>=c.options.maxLength&&a.inArray(b.which,c.validKeyCodes)===-1&&b.preventDefault()}),a.each(c.options.events,function(b,d){a(c.editorDoc).bind(b+".wysiwyg",function(a){d.apply(c.editorDoc,[a,c])})}),a.browser.msie?a(c.editorDoc).bind("beforedeactivate.wysiwyg",function(){c.savedRange=c.getInternalRange()}):a(c.editorDoc).bind("blur.wysiwyg",function(){c.savedRange=c.getInternalRange()}),a(c.editorDoc.body).addClass("wysiwyg"),c.options.events&&c.options.events.save&&(f=c.options.events.save,a(c.editorDoc).bind("keyup.wysiwyg",f),a(c.editorDoc).bind("change.wysiwyg",f),a.support.noCloneEvent?a(c.editorDoc).bind("input.wysiwyg",f):(a(c.editorDoc).bind("paste.wysiwyg",f),a(c.editorDoc).bind("cut.wysiwyg",f)));if(c.options.xhtml5&&c.options.unicode){var g={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};c.events.bind("getContent",function(a){return a.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(a,b){g[b]||(b=b.toLowerCase(),g[b]||(b="__replacement"));var c=g[b];return String.fromCharCode(c)})})}a(c.original).trigger("ready.jwysiwyg",[c.editorDoc,c])},this.innerDocument=function(){var a=this.editor.get(0);if(a.nodeName.toLowerCase()==="iframe"){if(a.contentDocument)return a.contentDocument;if(a.contentWindow)return a.contentWindow.document;if(this.isDestroyed)return null;b.error("Unexpected error in innerDocument")}return a},this.insertHtml=function(b){var c,d;return!b||b.length===0?this:(a.browser.msie?(this.ui.focus(),this.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#"),c=this.getElementByAttributeValue("img","src","#jwysiwyg#"),c&&a(c).replaceWith(b)):a.browser.mozilla?1===a(b).length?(d=this.getInternalRange(),d.deleteContents(),d.insertNode(a(b).get(0))):this.editorDoc.execCommand("insertHTML",!1,b):this.editorDoc.execCommand("insertHTML",!1,b)||(this.editor.focus(),this.editorDoc.execCommand("insertHTML",!1,b)),this.saveContent(),this)},this.parseControls=function(){var b=this;return a.each(this.options.controls,function(c,d){a.each(d,function(d){if(-1===a.inArray(d,b.availableControlProperties))throw c+'["'+d+'"]: property "'+d+'" not exists in Wysiwyg.availableControlProperties'})}),this.options.parseControls?this.options.parseControls.call(this):this.options.controls},this.removeFormat=function(){return a.browser.msie&&this.ui.focus(),this.options.removeHeadings&&this.editorDoc.execCommand("formatBlock",!1,"<p>"),this.editorDoc.execCommand("removeFormat",!1,null),this.editorDoc.execCommand("unlink",!1,null),a.wysiwyg.rmFormat&&a.wysiwyg.rmFormat.enabled&&("object"==typeof this.options.plugins.rmFormat.rmMsWordMarkup?a.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}}):a.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:!0}}})),this},this.ui.removeHoverClass=function(){a(this).removeClass("wysiwyg-button-hover")},this.resetFunction=function(){this.setContent(this.initialContent)},this.saveContent=function(){if(this.viewHTML)return;if(this.original){var b,c;b=this.getContent(),this.options.rmUnwantedBr&&(b=b.replace(/<br\/?>$/,"")),this.options.replaceDivWithP&&(c=a("<div/>").addClass("temp").append(b),c.children("div").each(function(){var b=a(this),c=b.find("p"),d;if(0===c.length){c=a("<p></p>");if(this.attributes.length>0)for(d=0;d<this.attributes.length;d+=1)c.attr(this.attributes[d].name,b.attr(this.attributes[d].name));c.append(b.html()),b.replaceWith(c)}}),b=c.html()),a(this.original).val(b),this.options.events&&this.options.events.save&&this.options.events.save.call(this)}return this},this.setContent=function(a){return this.editorDoc.body.innerHTML=a,this.saveContent(),this},this.triggerControl=function(a,c){var d=c.command||a,e=c.arguments||[];if(c.exec)c.exec.apply(this);else{this.ui.focus(),this.ui.withoutCss();try{this.editorDoc.execCommand(d,!1,e)}catch(f){b.error(f)}}this.options.autoSave&&this.autoSaveFunction()},this.triggerControlCallback=function(b){a(window).trigger("trigger-"+b+".wysiwyg",[this])},this.ui.withoutCss=function(){var b=this.self;if(a.browser.mozilla)try{b.editorDoc.execCommand("styleWithCSS",!1,!1)}catch(c){try{b.editorDoc.execCommand("useCSS",!1,!0)}catch(d){}}return b},this.wrapInitialContent=function(){var a=this.initialContent,b=a.match(/<\/?p>/gi);return b?a:"<p>"+a+"</p>"}}"use strict";var b=window.console?window.console:{log:a.noop,error:function(b){a.error(b)}},c="prop"in a.fn&&"removeProp"in a.fn;a.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(b,c,d){return b.each(function(){var b=a(this).data("wysiwyg"),e={},f;if(!b)return this;e[c]=a.extend(!0,{visible:!0,custom:!0},d),a.extend(!0,b.options.controls,e),f=a(b.options.toolbarHtml),b.ui.toolbar.replaceWith(f),b.ui.toolbar=f,b.ui.appendControls()})},clear:function(b){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.setContent("")})},console:b,destroy:function(b){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.destroy()})},document:function(b){var c=b.data("wysiwyg");return c?a(c.editorDoc):undefined},getContent:function(a){var b=a.data("wysiwyg");return b?b.getContent():undefined},getSelection:function(a){var b=a.data("wysiwyg");return b?b.getRangeText():undefined},init:function(b,c){return b.each(function(){var b=a.extend(!0,{},c),e;if("textarea"!==this.nodeName.toLowerCase()||a(this).data("wysiwyg"))return;e=new d,e.init(this,b),a.data(this,"wysiwyg",e),a(e.editorDoc).trigger("afterInit.wysiwyg")})},insertHtml:function(b,c){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.insertHtml(c)})},plugin:{listeners:{},bind:function(b){var c=this;a.each(this.listeners,function(d,e){var f,g;for(f=0;f<e.length;f+=1)g=c.parseName(e[f]),a(b.editorDoc).bind(d+".wysiwyg",{plugin:g},function(c){a.wysiwyg[c.data.plugin.name][c.data.plugin.method].apply(a.wysiwyg[c.data.plugin.name],[b])})})},exists:function(b){var c;return"string"!=typeof b?!1:(c=this.parseName(b),!a.wysiwyg[c.name]||!a.wysiwyg[c.name][c.method]?!1:!0)},listen:function(b,c){var d;return d=this.parseName(c),!a.wysiwyg[d.name]||!a.wysiwyg[d.name][d.method]?!1:(this.listeners[b]||(this.listeners[b]=[]),this.listeners[b].push(c),!0)},parseName:function(a){var b;return"string"!=typeof a?!1:(b=a.split("."),2>b.length?!1:{name:b[0],method:b[1]})},register:function(c){return c.name||b.error("Plugin name missing"),a.each(a.wysiwyg,function(a){a===c.name&&b.error("Plugin with name '"+c.name+"' was already registered")}),a.wysiwyg[c.name]=c,!0}},removeFormat:function(b){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.removeFormat()})},save:function(b){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.saveContent()})},selectAll:function(a){var b=a.data("wysiwyg"),c,d,e;if(!b)return this;c=b.editorDoc.body,window.getSelection?(e=b.getInternalSelection(),e.selectAllChildren(c)):(d=c.createTextRange(),d.moveToElementText(c),d.select())},setContent:function(b,c){return b.each(function(){var b=a(this).data("wysiwyg");if(!b)return this;b.setContent(c)})},triggerControl:function(c,d){return c.each(function(){var c=a(this).data("wysiwyg");if(!c)return this;c.controls[d]||b.error("Control '"+d+"' not exists"),c.triggerControl.apply(c,[d,c.controls[d]])})},support:{prop:c},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(b){var c=this,d,e=[];return this.extraSafeEntities[1].length===0&&a.each(this.extraSafeEntities[0],function(a,b){c.extraSafeEntities[1].push(b.charCodeAt(0))}),d=b.split(""),a.each(d,function(b){var f=d[b].charCodeAt(0);a.inArray(f,c.extraSafeEntities[1])&&(f<65||f>127||f>90&&f<97)?e.push("&#"+f+";"):e.push(d[b])}),e.join("")}}},a.wysiwyg.dialog=function(b,c){var d=b&&b.options&&b.options.dialog?b.options.dialog:c.theme?c.theme:"default",e=new a.wysiwyg.dialog.createDialog(d),f=this,g=a(f);return this.options={modal:!0,draggable:!0,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2e3,open:!1,close:!1},this.isOpen=!1,a.extend(this.options,c),this.object=e,this.open=function(){this.isOpen=!0,e.init.apply(f,[]);var a=e.show.apply(f,[]);g.trigger("afterOpen",[a])},this.show=function(){this.isOpen=!0,g.trigger("beforeShow");var a=e.show.apply(f,[]);g.trigger("afterShow")},this.hide=function(){this.isOpen=!1,g.trigger("beforeHide");var a=e.hide.apply(f,[]);g.trigger("afterHide",[a])},this.close=function(){this.isOpen=!1;var a=e.hide.apply(f,[]);g.trigger("beforeClose",[a]),e.destroy.apply(f,[]),g.trigger("afterClose",[a])},this.options.open&&g.bind("afterOpen",this.options.open),this.options.close&&g.bind("afterClose",this.options.close),this},a.extend(!0,a.wysiwyg.dialog,{_themes:{},_theme:"",register:function(b,c){a.wysiwyg.dialog._themes[b]=c},deregister:function(b){delete a.wysiwyg.dialog._themes[b]},createDialog:function(b){return new a.wysiwyg.dialog._themes[b]},getDimensions:function(){var b=document.body.scrollWidth,c=document.body.scrollHeight;return a.browser.opera&&(c=Math.max(a(document).height(),a(window).height(),document.documentElement.clientHeight)),[b,c]}}),a(function(){jQuery.ui&&a.wysiwyg.dialog.register("jqueryui",function(){var b=this;this._$dialog=null,this.init=function(){var c=this,d=this.options.content;typeof d=="object"&&(typeof d.html=="function"?d=d.html():typeof d.toString=="function"&&(d=d.toString())),b._$dialog=a("<div></div>").attr("title",this.options.title).html(d);var e=this.options.height=="auto"?300:this.options.height,f=this.options.width=="auto"?450:this.options.width;return b._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:e,width:f}),b._$dialog},this.show=function(){return b._$dialog.dialog("open"),b._$dialog},this.hide=function(){return b._$dialog.dialog("close"),b._$dialog},this.destroy=function(){return b._$dialog.dialog("destroy"),b._$dialog}}),a.wysiwyg.dialog.register("default",function(){var b=this;this._$dialog=null,this.init=function(){var c=this,d=this.options.content;typeof d=="object"&&(typeof d.html=="function"?d=d.html():typeof d.toString=="function"&&(d=d.toString())),b._$dialog=a('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var e=a('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>"),f=a('<a href="#" class="wysiwyg-dialog-close-button">X</a>');f.click(function(){c.close()}),e.find(".wysiwyg-dialog-close-wrapper").prepend(f);var g=a('<div class="wysiwyg-dialog-content">'+d+"</div>");b._$dialog.append(e).append(g);var h=this.options.height=="auto"?300:this.options.height,i=this.options.width=="auto"?450:this.options.width;return b._$dialog.hide().css({width:i,height:h,left:(a(window).width()-i)/2,top:(a(window).height()-h)/3}),a("body").append(b._$dialog),b._$dialog},this.show=function(){if(this.options.modal){var c=a.wysiwyg.dialog.getDimensions(),d=a('<div class="wysiwyg-dialog-modal-div"></div>').css({width:c[0],height:c[1]});b._$dialog.wrap(d)}if(this.options.draggable){var e=!1;b._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(b){b.preventDefault(),a(this).css({cursor:"move"});var c=a(this),d=a(this).parents(".wysiwyg-dialog"),f=b.pageX-parseInt(d.css("left"),10),g=b.pageY-parseInt(d.css("top"),10);e=!0,a(this).css({cursor:"move"}),a(document).bind("mousemove",function(a){a.preventDefault(),e&&d.css({top:a.pageY-g,left:a.pageX-f})}).bind("mouseup",function(b){b.preventDefault(),e=!1,c.css({cursor:"auto"}),a(document).unbind("mousemove").unbind("mouseup")})})}return b._$dialog.show(),b._$dialog},this.hide=function(){return b._$dialog.hide(),b._$dialog},this.destroy=function(){return this.options.modal&&b._$dialog.unwrap(),this.options.draggable&&b._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown"),b._$dialog.remove(),b._$dialog}})}),a.fn.wysiwyg=function(c){var d=arguments,e;if("undefined"!=typeof a.wysiwyg[c])return d=Array.prototype.concat.call([d[0]],[this],Array.prototype.slice.call(d,1)),a.wysiwyg[c].apply(a.wysiwyg,Array.prototype.slice.call(d,1));if("object"==typeof c||!c)return Array.prototype.unshift.call(d,this),a.wysiwyg.init.apply(a.wysiwyg,d);if(a.wysiwyg.plugin.exists(c))return e=a.wysiwyg.plugin.parseName(c),d=Array.prototype.concat.call([d[0]],[this],Array.prototype.slice.call(d,1)),a.wysiwyg[e.name][e.method].apply(a.wysiwyg[e.name],Array.prototype.slice.call(d,1));b.error("Method '"+c+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins")},a.fn.getWysiwyg=function(){return this.data("wysiwyg")}})(jQuery),function(a){"use strict";if(undefined===a.wysiwyg)throw"wysiwyg.colorpicker.js depends on $.wysiwyg";a.wysiwyg.controls||(a.wysiwyg.controls={}),a.wysiwyg.controls.colorpicker={modalOpen:!1,color:{back:{prev:"#ffffff",palette:[]},fore:{prev:"#123456",palette:[]}},addColorToPalette:function(b,c){-1===a.inArray(c,this.color[b].palette)?this.color[b].palette.push(c):this.color[b].palette.sort(function(a,b){return a===c?1:0})},init:function(b){if(a.wysiwyg.controls.colorpicker.modalOpen===!0)return!1;a.wysiwyg.controls.colorpicker.modalOpen=!0;var c=this,d,e,f,g,h,i;g={legend:"Colorpicker",color:"Color",submit:"Apply",reset:"Cancel"},f='<form class="wysiwyg"><fieldset><legend>{legend}</legend><ul class="palette"></ul><label>{color}: <input type="text" name="color" value="#123456"/></label><div class="wheel"></div><input type="submit" class="button" value="{submit}"/> <input type="reset" value="{reset}"/></fieldset></form>';for(h in g)a.wysiwyg.i18n&&(i=a.wysiwyg.i18n.t(g[h],"dialogs.colorpicker"),i===g[h]&&(i=a.wysiwyg.i18n.t(g[h],"dialogs")),g[h]=i),f=f.replace("{"+h+"}",g[h]);a.modal?(d=a(f),a.farbtastic&&(this.renderPalette(d,"fore"),d.find(".wheel").farbtastic(d.find("input:text"))),a.modal(d.html(),{maxWidth:b.defaults.formWidth,maxHeight:b.defaults.formHeight,overlayClose:!0,onShow:function(d){a("input:submit",d.data).click(function(e){var f=a('input[name="color"]',d.data).val();return c.color.fore.prev=f,c.addColorToPalette("fore",f),a.browser.msie&&b.ui.returnRange(),b.editorDoc.execCommand("ForeColor",!1,f),a.modal.close(),!1}),a("input:reset",d.data).click(function(c){return a.browser.msie&&b.ui.returnRange(),a.modal.close(),!1}),a("fieldset",d.data).click(function(a){a.stopPropagation()})},onClose:function(b){a.wysiwyg.controls.colorpicker.modalOpen=!1,a.modal.close()}})):a.fn.dialog?(d=a(f),a.farbtastic&&(this.renderPalette(d,"fore"),d.find(".wheel").farbtastic(d.find("input:text"))),e=d.appendTo("body"),e.dialog({modal:!0,open:function(f,g){a("input:submit",d).click(function(d){var f=a('input[name="color"]',e).val();return c.color.fore.prev=f,c.addColorToPalette("fore",f),a.browser.msie&&b.ui.returnRange(),b.editorDoc.execCommand("ForeColor",!1,f),a(e).dialog("close"),!1}),a("input:reset",d).click(function(c){return a.browser.msie&&b.ui.returnRange(),a(e).dialog("close"),!1}),a("fieldset",d).click(function(a){a.stopPropagation()})},close:function(b,c){a.wysiwyg.controls.colorpicker.modalOpen=!1,e.dialog("destroy"),e.remove()}})):a.farbtastic&&(d=a("<div/>").css({position:"fixed","z-index":2e3,left:"50%",top:"50%",background:"rgb(0, 0, 0)","margin-top":-1*Math.round(b.defaults.formHeight/2),"margin-left":-1*Math.round(b.defaults.formWidth/2)}).html(f),this.renderPalette(d,"fore"),d.find("input[name=color]").val(c.color.fore.prev),d.find(".wheel").farbtastic(d.find("input:text")),a("input:submit",d).click(function(e){var f=a('input[name="color"]',d).val();return c.color.fore.prev=f,c.addColorToPalette("fore",f),a.browser.msie&&b.ui.returnRange(),b.editorDoc.execCommand("ForeColor",!1,f),a(d).remove(),a.wysiwyg.controls.colorpicker.modalOpen=!1,!1}),a("input:reset",d).click(function(c){return a.browser.msie&&b.ui.returnRange(),a(d).remove(),a.wysiwyg.controls.colorpicker.modalOpen=!1,!1}),a("body").append(d),d.click(function(a){a.stopPropagation()}))},renderPalette:function(b,c){var d=b.find(".palette"),e=function(){var c=a(this).text();b.find("input[name=color]").val(c),a.farbtastic&&b.find("input[name=color]").trigger("keyup")},f,g,h;for(h=this.color[c].palette.length-1;h>-1;h-=1)f=a("<div/>").css({"float":"left",width:"16px",height:"16px",margin:"0px 5px 0px 0px","background-color":this.color[c].palette[h]}),g=a("<li>"+this.color[c].palette[h]+"</li>").css({"float":"left","list-style":"none"}).append(f).bind("click.wysiwyg",e),d.append(g).css({margin:"0px",padding:"0px"})}}}(jQuery),function(a){if(undefined===a.wysiwyg)throw"wysiwyg.cssWrap.js depends on $.wysiwyg";a.wysiwyg.controls||(a.wysiwyg.controls={}),a.wysiwyg.controls.cssWrap={init:function(b){var c=this,d,e,f,g={legend:"Wrap Element",wrapperType:"Wrapper Type",ID:"ID","class":"Class",wrap:"Wrap",unwrap:"Unwrap",cancel:"Cancel"};d='<form class="wysiwyg"><fieldset><legend>{legend}</legend><div class="wysiwyg-dialogRow"><label>{wrapperType}: &nbsp;<select name="type"><option value="span">Span</option><option value="div">Div</option></select></label></div><div class="wysiwyg-dialogRow"><label>{ID}: &nbsp;<input name="id" type="text" /></label></div><div class="wysiwyg-dialogRow"><label>{class}: &nbsp;<input name="class" type="text" /></label></div><div class="wysiwyg-dialogRow"><input type="button" class="button cssWrap-unwrap" style="display:none;" value="{unwrap}"/></label><input type="submit"  class="button cssWrap-submit" value="{wrap}"/></label><input type="reset" class="button cssWrap-cancel" value="{cancel}"/></div></fieldset></form>';for(e in g)a.wysiwyg.i18n&&(f=a.wysiwyg.i18n.t(g[e]),f===g[e]&&(f=a.wysiwyg.i18n.t(g[e],"dialogs")),g[e]=f),d=d.replace("{"+e+"}",g[e]);return a(".wysiwyg-dialog-wrapper").length||(a(d).appendTo("body"),a("form.wysiwyg").dialog({modal:!0,open:function(c,d){var e=a(this),f=b.getInternalRange(),g,h;if(f)a.browser.msie&&b.ui.focus(),g=a(f.commonAncestorContainer);else return alert("You must select some elements before you can wrap them."),e.dialog("close"),0;h=f.commonAncestorContainer.nodeName.toLowerCase(),g.parent(".wysiwygCssWrapper").length&&(alert(g.parent(".wysiwygCssWrapper").get(0).nodeName.toLowerCase()),e.find("select[name=type]").val(g.parent(".wysiwygCssWrapper").get(0).nodeName.toLowerCase()),e.find("select[name=type]").attr("disabled","disabled"),e.find("input[name=id]").val(g.parent(".wysiwygCssWrapper").attr("id")),e.find("input[name=class]").val(g.parent(".wysiwygCssWrapper").attr("class").replace("wysiwygCssWrapper ","")),a("form.wysiwyg").find(".cssWrap-unwrap").show(),a("form.wysiwyg").find(".cssWrap-unwrap").click(function(a){return a.preventDefault(),h!=="body"&&g.unwrap(),e.dialog("close"),1})),a("form.wysiwyg").find(".cssWrap-submit").click(function(b){b.preventDefault();var c=a("form.wysiwyg").find("select[name=type]").val(),d=a("form.wysiwyg").find("input[name=id]").val(),f=a("form.wysiwyg").find("input[name=class]").val();h!=="body"&&(g.parent(".wysiwygCssWrapper").length?(g.parent(".wysiwygCssWrapper").attr("id",f),g.parent(".wysiwygCssWrapper").attr("class",f)):g.wrap("<"+c+' id="'+d+'" class="'+"wysiwygCssWrapper "+f+'"/>')),e.dialog("close")}),a("form.wysiwyg").find(".cssWrap-cancel").click(function(a){return a.preventDefault(),e.dialog("close"),1})},close:function(){a(this).dialog("destroy"),a(this).remove()}}),b.saveContent()),a(b.editorDoc).trigger("editorRefresh.wysiwyg"),1}}}(jQuery),function(a){"use strict";if(undefined===a.wysiwyg)throw"wysiwyg.image.js depends on $.wysiwyg";a.wysiwyg.controls||(a.wysiwyg.controls={}),a.wysiwyg.controls.image={groupIndex:6,visible:!0,exec:function(){a.wysiwyg.controls.image.init(this)},tags:["img"],tooltip:"Insert image",init:function(b){var c=this,d,e,f,g,h,i,j,k,l={alt:"",self:b.dom?b.dom.getElement("img"):null,src:"http://",title:""};i={legend:"Insert Image",preview:"Preview",url:"URL",title:"Title",description:"Description",width:"Width",height:"Height",original:"Original W x H","float":"Float",floatNone:"None",floatLeft:"Left",floatRight:"Right",submit:"Insert Image",reset:"Cancel",fileManagerIcon:"Select file from server"},g='<form class="wysiwyg" id="wysiwyg-addImage"><fieldset><div class="form-row"><span class="form-row-key">{preview}:</span><div class="form-row-value"><img src="" alt="{preview}" style="margin: 2px; padding:5px; max-width: 100%; overflow:hidden; max-height: 100px; border: 1px solid rgb(192, 192, 192);"/></div></div><div class="form-row"><label for="name">{url}:</label><div class="form-row-value"><input type="text" name="src" value=""/>',a.wysiwyg.fileManager&&a.wysiwyg.fileManager.ready&&(g+='<div class="wysiwyg-fileManager" title="{fileManagerIcon}"/>'),g+='</div></div><div class="form-row"><label for="name">{title}:</label><div class="form-row-value"><input type="text" name="imgtitle" value=""/></div></div><div class="form-row"><label for="name">{description}:</label><div class="form-row-value"><input type="text" name="description" value=""/></div></div><div class="form-row"><label for="name">{width} x {height}:</label><div class="form-row-value"><input type="text" name="width" value="" class="width-small"/> x <input type="text" name="height" value="" class="width-small"/></div></div><div class="form-row"><label for="name">{original}:</label><div class="form-row-value"><input type="text" name="naturalWidth" value="" class="width-small" disabled="disabled"/> x <input type="text" name="naturalHeight" value="" class="width-small" disabled="disabled"/></div></div><div class="form-row"><label for="name">{float}:</label><div class="form-row-value"><select name="float"><option value="">{floatNone}</option><option value="left">{floatLeft}</option><option value="right">{floatRight}</option></select></div></div><div class="form-row form-row-last"><label for="name"></label><div class="form-row-value"><input type="submit" class="button" value="{submit}"/> <input type="reset" value="{reset}"/></div></div></fieldset></form>';for(j in i)a.wysiwyg.i18n&&(k=a.wysiwyg.i18n.t(i[j],"dialogs.image"),k===i[j]&&(k=a.wysiwyg.i18n.t(i[j],"dialogs")),i[j]=k),h=new RegExp("{"+j+"}","g"),g=g.replace(h,i[j]);l.self&&(l.src=l.self.src?l.self.src:"",l.alt=l.self.alt?l.self.alt:"",l.title=l.self.title?l.self.title:"",l.width=l.self.width?l.self.width:"",l.height=l.self.height?l.self.height:"",l.styleFloat=a(l.self).css("float")),e=new a.wysiwyg.dialog(b,{title:i.legend,content:g}),a(e).bind("afterOpen",function(d,f){f.find("form#wysiwyg-addImage").submit(function(a){return a.preventDefault(),c.processInsert(f.container,b,l),e.close(),!1}),a.wysiwyg.fileManager&&a("div.wysiwyg-fileManager").bind("click",function(){a.wysiwyg.fileManager.init(function(a){f.find("input[name=src]").val(a),f.find("input[name=src]").trigger("change")})}),a("input:reset",f).click(function(a){return e.close(),!1}),a("fieldset",f).click(function(a){a.stopPropagation()}),c.makeForm(f,l)}),e.open(),a(b.editorDoc).trigger("editorRefresh.wysiwyg")},processInsert:function(b,c,d){var e,f=a('input[name="src"]',b).val(),g=a('input[name="imgtitle"]',b).val(),h=a('input[name="description"]',b).val(),i=a('input[name="width"]',b).val(),j=a('input[name="height"]',b).val(),k=a('select[name="float"]',b).val(),l=[],m="",n,o;c.options.controlImage&&c.options.controlImage.forceRelativeUrls&&(o=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),0===f.indexOf(o)&&(f=f.substr(o.length))),d.self?(a(d.self).attr("src",f).attr("title",g).attr("alt",h).css("float",k),i.toString().match(/^[0-9]+(px|%)?$/)?a(d.self).css("width",i):a(d.self).css("width",""),j.toString().match(/^[0-9]+(px|%)?$/)?a(d.self).css("height",j):a(d.self).css("height",""),c.saveContent()):(n=i.toString().match(/^[0-9]+(px|%)?$/),n&&(n[1]?l.push("width: "+i+";"):l.push("width: "+i+"px;")),n=j.toString().match(/^[0-9]+(px|%)?$/),n&&(n[1]?l.push("height: "+j+";"):l.push("height: "+j+"px;")),k.length>0&&l.push("float: "+k+";"),l.length>0&&(m=' style="'+l.join(" ")+'"'),e="<img src='"+f+"' title='"+g+"' alt='"+h+"'"+m+"/>",c.insertHtml(e))},makeForm:function(a,b){return a.find("input[name=src]").val(b.src),a.find("input[name=imgtitle]").val(b.title),a.find("input[name=description]").val(b.alt),a.find('input[name="width"]').val(b.width),a.find('input[name="height"]').val(b.height),a.find('select[name="float"]').val(b.styleFloat),a.find("img").attr("src",b.src),a.find("img").bind("load",function(){a.find("img").get(0).naturalWidth?(a.find('input[name="naturalWidth"]').val(a.find("img").get(0).naturalWidth),a.find('input[name="naturalHeight"]').val(a.find("img").get(0).naturalHeight)):a.find("img").attr("naturalWidth")&&(a.find('input[name="naturalWidth"]').val(a.find("img").attr("naturalWidth")),a.find('input[name="naturalHeight"]').val(a.find("img").attr("naturalHeight")))}),a.find("input[name=src]").bind("change",function(){a.find("img").attr("src",this.value)}),a}},a.wysiwyg.insertImage=function(b,c,d){return b.each(function(){var b=a(this).data("wysiwyg"),e,f;if(!b)return this;if(!c||c.length===0)return this;a.browser.msie&&b.ui.focus();if(d){b.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#"),e=b.getElementByAttributeValue("img","src","#jwysiwyg#");if(e){e.src=c;for(f in d)d.hasOwnProperty(f)&&e.setAttribute(f,d[f])}}else b.editorDoc.execCommand("insertImage",!1,c);return b.saveContent(),a(b.editorDoc).trigger("editorRefresh.wysiwyg"),this})}}(jQuery),function(a){"use strict";if(undefined===a.wysiwyg)throw"wysiwyg.link.js depends on $.wysiwyg";a.wysiwyg.controls||(a.wysiwyg.controls={}),a.wysiwyg.controls.link={init:function(b){var c=this,d,e,f,g,h,i,j,k,l,m,n,o;j={legend:"Insert Link",url:"Link URL",title:"Link Title",target:"Link Target",submit:"Insert Link",reset:"Cancel"},i='<form class="wysiwyg"><fieldset><legend>{legend}</legend><label>{url}: <input type="text" name="linkhref" value=""/></label><label>{title}: <input type="text" name="linktitle" value=""/></label><label>{target}: <input type="text" name="linktarget" value=""/></label><input type="submit" class="button" value="{submit}"/> <input type="reset" value="{reset}"/></fieldset></form>';for(k in j)a.wysiwyg.i18n&&(l=a.wysiwyg.i18n.t(j[k],"dialogs.link"),l===j[k]&&(l=a.wysiwyg.i18n.t(j[k],"dialogs")),j[k]=l),m=new RegExp("{"+k+"}","g"),i=i.replace(m,j[k]);g={self:b.dom.getElement("a"),href:"http://",title:"",target:""},g.self&&(g.href=g.self.href?g.self.href:g.href,g.title=g.self.title?g.self.title:"",g.target=g.self.target?g.self.target:"");if(a.fn.dialog){d=a(i),d.find("input[name=linkhref]").val(g.href),d.find("input[name=linktitle]").val(g.title),d.find("input[name=linktarget]").val(g.target);if(a.browser.msie)try{e=d.appendTo(b.editorDoc.body)}catch(p){e=d.appendTo("body")}else e=d.appendTo("body");e.dialog({modal:!0,open:function(c,d){a("input:submit",e).click(function(c){c.preventDefault();var d=a('input[name="linkhref"]',e).val(),f=a('input[name="linktitle"]',e).val(),i=a('input[name="linktarget"]',e).val(),j,k;b.options.controlLink.forceRelativeUrls&&(j=window.location.protocol+"//"+window.location.hostname,0===d.indexOf(j)&&(d=d.substr(j.length))),g.self?"string"==typeof d&&(d.length>0?a(g.self).attr("href",d).attr("title",f).attr("target",i):a(g.self).replaceWith(g.self.innerHTML)):(a.browser.msie&&b.ui.returnRange(),h=b.getRangeText(),k=b.dom.getElement("img"),h&&h.length>0||k?(a.browser.msie&&b.ui.focus(),"string"==typeof d&&(d.length>0?b.editorDoc.execCommand("createLink",!1,d):b.editorDoc.execCommand("unlink",!1,null)),g.self=b.dom.getElement("a"),a(g.self).attr("href",d).attr("title",f),a(g.self).attr("target",i)):b.options.messages.nonSelection&&window.alert(b.options.messages.nonSelection)),b.saveContent(),a(e).dialog("close")}),a("input:reset",e).click(function(b){b.preventDefault(),a(e).dialog("close")})},close:function(a,b){e.dialog("destroy"),e.remove()}})}else g.self?(f=window.prompt("URL",g.href),b.options.controlLink.forceRelativeUrls&&(n=window.location.protocol+"//"+window.location.hostname,0===f.indexOf(n)&&(f=f.substr(n.length))),"string"==typeof f&&(f.length>0?a(g.self).attr("href",f):a(g.self).replaceWith(g.self.innerHTML))):(h=b.getRangeText(),o=b.dom.getElement("img"),h&&h.length>0||o?a.browser.msie?(b.ui.focus(),b.editorDoc.execCommand("createLink",!0,null)):(f=window.prompt(j.url,g.href),b.options.controlLink.forceRelativeUrls&&(n=window.location.protocol+"//"+window.location.hostname,0===f.indexOf(n)&&(f=f.substr(n.length))),"string"==typeof f&&(f.length>0?b.editorDoc.execCommand("createLink",!1,f):b.editorDoc.execCommand("unlink",!1,null))):b.options.messages.nonSelection&&window.alert(b.options.messages.nonSelection)),b.saveContent();a(b.editorDoc).trigger("editorRefresh.wysiwyg")}},a.wysiwyg.createLink=function(b,c){return b.each(function(){var b=a(this).data("wysiwyg"),d;return b?!c||c.length===0?this:(d=b.getRangeText(),d&&d.length>0?(a.browser.msie&&b.ui.focus(),b.editorDoc.execCommand("unlink",!1,null),b.editorDoc.execCommand("createLink",!1,c)):b.options.messages.nonSelection&&window.alert(b.options.messages.nonSelection),this):this})}}(jQuery),function(a){"use strict";if(undefined===a.wysiwyg)throw"wysiwyg.table.js depends on $.wysiwyg";a.wysiwyg.controls||(a.wysiwyg.controls={});var b=function(a,b,c){if(isNaN(b)||isNaN(a)||b===null||a===null)return;var d,e,f=['<table border="1" style="width: 100%;"><tbody>'];a=parseInt(a,10),b=parseInt(b,10),c===null&&(c="&nbsp;"),c="<td>"+c+"</td>";for(d=b;d>0;d-=1){f.push("<tr>");for(e=a;e>0;e-=1)f.push(c);f.push("</tr>")}return f.push("</tbody></table>"),this.insertHtml(f.join(""))};a.wysiwyg.controls.table=function(c){var d,e,f,g,h,i,j,k,l;i={legend:"Insert table",cols:"Count of columns",rows:"Count of rows",submit:"Insert table",reset:"Cancel"},h='<form class="wysiwyg" id="wysiwyg-tableInsert"><fieldset><legend>{legend}</legend><label>{cols}: <input type="text" name="colCount" value="3" /></label><br/><label>{rows}: <input type="text" name="rowCount" value="3" /></label><br/><input type="submit" class="button" value="{submit}"/> <input type="reset" value="{reset}"/></fieldset></form>';for(j in i)a.wysiwyg.i18n&&(k=a.wysiwyg.i18n.t(i[j],"dialogs.table"),k===i[j]&&(k=a.wysiwyg.i18n.t(i[j],"dialogs")),i[j]=k),l=new RegExp("{"+j+"}","g"),h=h.replace(l,i[j]);c.insertTable||(c.insertTable=b),d=new a.wysiwyg.dialog(c,{title:i.legend,content:h,open:function(a,b){b.find("form#wysiwyg-tableInsert").submit(function(a){return a.preventDefault(),g=b.find("input[name=rowCount]").val(),f=b.find("input[name=colCount]").val(),c.insertTable(f,g,c.defaults.tableFiller),d.close(),!1}),b.find("input:reset").click(function(a){return a.preventDefault(),d.close(),!1})}}),d.open(),a(c.editorDoc).trigger("editorRefresh.wysiwyg")},a.wysiwyg.insertTable=function(c,d,e,f){return c.each(function(){var c=a(this).data("wysiwyg");return c.insertTable||(c.insertTable=b),c?(c.insertTable(d,e,f),a(c.editorDoc).trigger("editorRefresh.wysiwyg"),this):this})}}(jQuery)